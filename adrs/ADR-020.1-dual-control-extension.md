# ADR-020.1: Dual-Control Extension for Ï„Â²-bench Compatibility

## Status
Proposed

## Date
2026-01-27

## Dependencies
- **ADR-020**: Ï„-bench Inspired Evaluation Framework (base implementation)
- **ADR-017**: Simulated Apps Framework (app execution)
- **ADR-018**: App Studio Backend (dynamic app definitions)

## Context

### Problem Statement

ADR-020 implemented Ï„-bench (2024) patterns for task evaluation. However, Ï„Â²-bench (June 2025) introduces **dual-control environments** where:

1. **Agent** has tools to access backend systems (customer DB, account management)
2. **User** has tools to control their own device (toggle settings, check status)
3. Both must **coordinate** - agent instructs, user executes

AgentWorld's current model treats all participants as equal agents with symmetric app access. This prevents measuring the **~25 point performance drop** observed in Ï„Â²-bench when agents must guide users instead of acting autonomously ([arXiv:2506.07982](https://arxiv.org/abs/2506.07982), Table 2).

### Research Foundation

From Ï„Â²-bench ([arXiv:2506.07982](https://arxiv.org/abs/2506.07982)):

> "Significant performance drops when agents shift from no-user to dual-control, highlighting the challenges of guiding users."

```
Solo Mode (agent has all info):     60% pass^1
Dual-Control (agent guides user):   35% pass^1  (-25 points)
```

### Requirements

| ID | Requirement | Priority | Description |
|----|-------------|----------|-------------|
| REQ-20.1-01 | App Access Control | Must | Restrict which agents can use which apps |
| REQ-20.1-02 | Per-Agent App State | Must | Device apps have per-agent state |
| REQ-20.1-03 | Tool Type Annotations | Must | Mark tools as READ or WRITE |
| REQ-20.1-04 | Dual-Control Tasks | Must | Define tasks requiring agent-user coordination |
| REQ-20.1-05 | Coordination Tracking | Must | Track instruction â†’ action handoffs |
| REQ-20.1-06 | Solo/Dual Comparison | Should | Compare same task in solo vs dual mode |
| REQ-20.1-07 | User Instruction | Should | Define user's goal separately from agent |
| REQ-20.1-08 | Communication Metrics | Should | Measure instruction clarity |

## Decision

### Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DUAL-CONTROL ARCHITECTURE                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚   â”‚    SERVICE AGENT        â”‚            â”‚    CUSTOMER AGENT       â”‚        â”‚
â”‚   â”‚    (e.g., TechSupport)  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚    (e.g., John)         â”‚        â”‚
â”‚   â”‚                         â”‚  messages  â”‚                         â”‚        â”‚
â”‚   â”‚    Persona: Helpful     â”‚            â”‚    Persona: Frustrated  â”‚        â”‚
â”‚   â”‚    Role: service_agent  â”‚            â”‚    Role: customer       â”‚        â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚               â”‚                                      â”‚                       â”‚
â”‚               â”‚ Backend Tools                        â”‚ Device Tools          â”‚
â”‚               â–¼                                      â–¼                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚   â”‚    BACKEND APP          â”‚            â”‚    DEVICE APP           â”‚        â”‚
â”‚   â”‚    (Shared State)       â”‚            â”‚    (Per-Agent State)    â”‚        â”‚
â”‚   â”‚                         â”‚            â”‚                         â”‚        â”‚
â”‚   â”‚  access: [service_agent]â”‚            â”‚  access: [customer]     â”‚        â”‚
â”‚   â”‚  state_type: shared     â”‚            â”‚  state_type: per_agent  â”‚        â”‚
â”‚   â”‚                         â”‚            â”‚                         â”‚        â”‚
â”‚   â”‚  Tools (READ):          â”‚            â”‚  Tools (READ):          â”‚        â”‚
â”‚   â”‚  â€¢ get_customer_by_id   â”‚            â”‚  â€¢ get_status_bar       â”‚        â”‚
â”‚   â”‚  â€¢ get_account_details  â”‚            â”‚  â€¢ check_settings       â”‚        â”‚
â”‚   â”‚                         â”‚            â”‚                         â”‚        â”‚
â”‚   â”‚  Tools (WRITE):         â”‚            â”‚  Tools (WRITE):         â”‚        â”‚
â”‚   â”‚  â€¢ enable_roaming       â”‚            â”‚  â€¢ toggle_mobile_data   â”‚        â”‚
â”‚   â”‚  â€¢ change_plan          â”‚            â”‚  â€¢ toggle_airplane_mode â”‚        â”‚
â”‚   â”‚  â€¢ update_customer      â”‚            â”‚  â€¢ restart_device       â”‚        â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚               â”‚                                      â”‚                       â”‚
â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                              â”‚                                               â”‚
â”‚                              â–¼                                               â”‚
â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚               â”‚      SHARED WORLD STATE     â”‚                               â”‚
â”‚               â”‚                             â”‚                               â”‚
â”‚               â”‚  Backend changes visible    â”‚                               â”‚
â”‚               â”‚  to device (e.g., roaming   â”‚                               â”‚
â”‚               â”‚  enabled affects signal)    â”‚                               â”‚
â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
Caption: Dual-control requires role-restricted backend tools (service_agent) and per-agent device tools (customer), with shared world effects flowing between both sides.

### 1. App Types and Access Control

#### Glossary (App Types)

- **Shared App:** All agents can access; single shared state.
- **Backend App:** Role-restricted to service agents; shared backend state (e.g., customer DB).
- **Device App:** Role-restricted to customers; per-agent state (each user has their own device).

#### New App Categories

```python
class AppAccessType(str, Enum):
    """Who can access this app."""
    SHARED = "shared"           # All agents (current default)
    ROLE_RESTRICTED = "role_restricted"  # Only specific roles
    PER_AGENT = "per_agent"     # Each agent has their own instance

class AppStateType(str, Enum):
    """How state is managed."""
    SHARED = "shared"           # Single state for all agents
    PER_AGENT = "per_agent"     # Each agent has isolated state
```

#### Valid Access/State Combinations

| access_type | state_type | Valid | Example |
|-------------|------------|-------|---------|
| SHARED | SHARED | âœ… | Chat system (all agents, single state) |
| SHARED | PER_AGENT | âœ… | Personal notepad (all agents, isolated notes) |
| ROLE_RESTRICTED | SHARED | âœ… | Backend DB (service agents, shared customer data) |
| ROLE_RESTRICTED | PER_AGENT | âœ… | User device (customers, each has own device) |
| PER_AGENT | SHARED | âŒ | **Invalid** - if each agent has own instance, state must be isolated |
| PER_AGENT | PER_AGENT | âœ… | Personal sandbox (each agent, isolated state) |

> **Implementation Note:** When `access_type=PER_AGENT`, the UI must force `state_type=PER_AGENT` and disable the state selector.

#### Extended App Definition

```python
@dataclass
class AppDefinition:
    """Extended app definition with access control."""
    app_id: str
    name: str
    description: str
    category: str

    # NEW: Access control (defaults to SHARED for backward compatibility)
    access_type: AppAccessType = AppAccessType.SHARED
    allowed_roles: list[str] | None = None  # e.g., ["service_agent"]

    # NEW: State management (defaults to SHARED for simplicity)
    state_type: AppStateType = AppStateType.SHARED

    # Existing
    actions: list[ActionDefinition]
    state_schema: list[StateField]
    initial_config: dict
```

> **UX Simplification:** Default all apps to `SHARED/SHARED` access and state.
> Only configure `ROLE_RESTRICTED` or `PER_AGENT` for dual-control scenarios.
> This reduces complexity for 90%+ of apps while enabling Ï„Â²-bench compatibility when needed.

#### Example: Telecom Domain Apps

```python
# Backend App - Service Agent Only
TELECOM_BACKEND_APP = AppDefinition(
    app_id="telecom_backend",
    name="Telecom Backend",
    description="Customer service backend system",
    category="telecom",

    access_type=AppAccessType.ROLE_RESTRICTED,
    allowed_roles=["service_agent"],
    state_type=AppStateType.SHARED,

    actions=[
        ActionDefinition(
            name="get_customer_by_id",
            tool_type=ToolType.READ,
            description="Retrieve customer details",
            parameters={"customer_id": {"type": "string", "required": True}},
            # ... logic
        ),
        ActionDefinition(
            name="enable_roaming",
            tool_type=ToolType.WRITE,
            description="Enable international roaming for customer",
            parameters={
                "customer_id": {"type": "string", "required": True},
                "plan_type": {"type": "string", "enum": ["basic", "premium"]}
            },
            # ... logic
        ),
    ],
    state_schema=[
        StateField(name="customers", type="object", per_agent=False),
        StateField(name="plans", type="object", per_agent=False),
    ]
)

# Device App - Customer Only (Per-Agent State)
USER_DEVICE_APP = AppDefinition(
    app_id="user_device",
    name="User Device",
    description="User's mobile device controls",
    category="telecom",

    access_type=AppAccessType.ROLE_RESTRICTED,
    allowed_roles=["customer"],
    state_type=AppStateType.PER_AGENT,  # Each user has own device

    actions=[
        ActionDefinition(
            name="get_status_bar",
            tool_type=ToolType.READ,
            description="Check device status bar (signal, data, battery)",
            parameters={},
            # ... logic
        ),
        ActionDefinition(
            name="toggle_mobile_data",
            tool_type=ToolType.WRITE,
            description="Turn mobile data ON or OFF",
            parameters={},
            # ... logic
        ),
        ActionDefinition(
            name="toggle_airplane_mode",
            tool_type=ToolType.WRITE,
            description="Turn airplane mode ON or OFF",
            parameters={},
            # ... logic
        ),
    ],
    state_schema=[
        StateField(name="mobile_data_enabled", type="boolean", default=True),
        StateField(name="airplane_mode", type="boolean", default=False),
        StateField(name="signal_strength", type="string", default="excellent"),
        StateField(name="battery_level", type="integer", default=80),
        StateField(name="sim_status", type="string", default="active"),
    ]
)
```

#### Agent ID Immutability

Per-agent state uses key format `{app_id}:{agent_id}`. To prevent state orphaning:

```python
# Constraint: agent_id is immutable within a simulation
@dataclass
class AgentConfig:
    agent_id: str  # IMMUTABLE after simulation start

    def __post_init__(self):
        if not re.match(r'^[a-zA-Z][a-zA-Z0-9_-]*$', self.agent_id):
            raise ValueError("agent_id must be alphanumeric starting with letter")

# State key generation
def get_per_agent_state_key(app_id: str, agent_id: str) -> str:
    """Generate state key for per-agent state."""
    return f"{app_id}:{agent_id}"

# Migration strategy if agent_id change is ever needed
async def migrate_agent_state(
    old_agent_id: str,
    new_agent_id: str,
    app_id: str
) -> None:
    """Migrate per-agent state to new agent_id (use sparingly)."""
    old_key = get_per_agent_state_key(app_id, old_agent_id)
    new_key = get_per_agent_state_key(app_id, new_agent_id)
    state = await state_store.get(old_key)
    await state_store.set(new_key, state)
    await state_store.delete(old_key)
    logger.warning(f"Migrated state from {old_key} to {new_key}")
```

> **Best Practice:** Treat `agent_id` as immutable. If agent identity must change,
> use the migration function and log the change for audit purposes.

### 2. Tool Type Annotations

```python
class ToolType(str, Enum):
    """Tool classification for analysis and policy."""
    READ = "read"    # Queries state, no modifications
    WRITE = "write"  # Modifies state

@dataclass
class ActionDefinition:
    """Action with tool type annotation."""
    name: str
    description: str
    tool_type: ToolType  # NEW: READ or WRITE
    parameters: dict
    returns: dict
    logic: list[LogicBlock]
```

**Benefits:**
- Enable "READ-only agent" ablation studies
- Policy: "User can only WRITE after agent confirms"
- Safety analysis: Track state modifications

### 3. Agent Roles

```python
class AgentRole(str, Enum):
    """Built-in agent roles (extensible via tags)."""
    PEER = "peer"                 # Default: equal access to shared apps
    SERVICE_AGENT = "service_agent"  # Backend access, guides users
    CUSTOMER = "customer"         # Device access, follows instructions

@dataclass
class AgentConfig:
    """Extended agent configuration."""
    agent_id: str
    persona_id: str

    # NEW: Role-based access (primary role from enum)
    role: AgentRole = AgentRole.PEER

    # NEW: Role tags for fine-grained access (extensible)
    role_tags: list[str] = field(default_factory=list)  # e.g., ["supervisor", "tier_2"]

    # NEW: Role-specific instruction
    instruction: str | None = None  # What this agent should accomplish
```

#### Role Extensibility

The `AgentRole` enum covers common cases. For complex scenarios (supervisors, multiple service tiers), use `role_tags`:

```python
# App definition with tag-based access
ADMIN_PANEL_APP = AppDefinition(
    app_id="admin_panel",
    access_type=AppAccessType.ROLE_RESTRICTED,
    allowed_roles=["service_agent"],  # Primary role
    allowed_role_tags=["supervisor", "admin"],  # Additional tag-based access
    # ...
)

# Agent with supervisor access
supervisor_agent = AgentConfig(
    agent_id="jane_supervisor",
    role=AgentRole.SERVICE_AGENT,
    role_tags=["supervisor", "tier_2"],  # Can access admin panel
)

# Access check logic
def can_access_app(agent: AgentConfig, app: AppDefinition) -> bool:
    # Check primary role
    if app.allowed_roles and agent.role.value in app.allowed_roles:
        return True
    # Check role tags
    if app.allowed_role_tags:
        return bool(set(agent.role_tags) & set(app.allowed_role_tags))
    return app.access_type == AppAccessType.SHARED
```

> **Future Extension:** Role hierarchy (supervisor > service_agent > customer) could
> be added if needed, but tag-based access covers most multi-tier scenarios.

### 4. Dual-Control Task Definition

```python
@dataclass
class DualControlTaskDefinition:
    """Task requiring agent-user coordination."""
    task_id: str
    name: str
    description: str
    domain: str
    difficulty: str

    # Simulation setup
    simulation_config: SimulationConfig

    # Agent-side
    agent_id: str
    agent_role: AgentRole  # service_agent
    agent_instruction: str
    agent_apps: list[str]  # ["telecom_backend"]
    agent_initial_state: dict

    # User-side
    user_id: str
    user_role: AgentRole  # customer
    user_instruction: str  # What user is trying to achieve
    user_apps: list[str]   # ["user_device"]
    user_initial_state: dict  # Device state

    # Coordination requirements
    required_handoffs: list[CoordinationHandoff]

    # Goal states (both must be achieved)
    agent_goal_state: dict  # Backend state after success
    user_goal_state: dict   # Device state after success

    # Metrics
    max_turns: int
    expected_coordination_count: int

@dataclass
class InstructionTemplate:
    """Structured instruction matching (more reliable than free-form NLU)."""
    template_id: str
    # Keyword matching (any of these keywords triggers match)
    keywords: list[str]       # e.g., ["toggle", "turn", "switch"]
    # Target object matching
    target_keywords: list[str]  # e.g., ["data", "mobile data", "cellular"]
    # Optional: Semantic embedding for fallback matching
    semantic_embedding: list[float] | None = None
    # Confidence threshold for semantic matching
    semantic_threshold: float = 0.85

@dataclass
class CoordinationHandoff:
    """A required coordination point."""
    handoff_id: str
    from_role: AgentRole
    to_role: AgentRole
    instruction_pattern: str  # Regex to match instruction (legacy)
    instruction_template: InstructionTemplate | None = None  # NEW: Structured matching
    expected_action: str      # Action user should take
    description: str
```

#### Instruction Matching Strategy

Detecting "toggle your data" â†’ `toggle_mobile_data` is challenging. We use a tiered approach:

```python
def match_instruction(
    instruction_text: str,
    template: InstructionTemplate
) -> tuple[bool, float]:
    """Match instruction text against template.

    Returns (matched, confidence)
    """
    text_lower = instruction_text.lower()

    # Tier 1: Keyword matching (fast, high precision)
    action_keyword_found = any(kw in text_lower for kw in template.keywords)
    target_keyword_found = any(kw in text_lower for kw in template.target_keywords)

    if action_keyword_found and target_keyword_found:
        return True, 0.95  # High confidence keyword match

    # Tier 2: Semantic similarity (fallback, handles paraphrasing)
    if template.semantic_embedding:
        instruction_embedding = get_embedding(instruction_text)
        similarity = cosine_similarity(
            instruction_embedding,
            template.semantic_embedding
        )
        if similarity >= template.semantic_threshold:
            return True, similarity

    return False, 0.0

# Example template for "toggle mobile data"
TOGGLE_DATA_TEMPLATE = InstructionTemplate(
    template_id="toggle_mobile_data",
    keywords=["toggle", "turn", "switch", "enable", "disable", "turn on", "turn off"],
    target_keywords=["data", "mobile data", "cellular", "internet", "connectivity"],
    semantic_threshold=0.85
)
```

> **Reliability Note:** Keyword matching handles 80%+ of cases with high precision.
> Semantic fallback catches paraphrasing ("switch on your phone's internet") but
> may have false positives. Configure `semantic_threshold` based on domain needs.

### 5. Coordination Tracking

```python
@dataclass
class CoordinationEvent:
    """Tracked coordination between agent and user."""
    event_id: str
    timestamp: datetime

    # Who instructed
    instructor_id: str
    instructor_role: AgentRole
    instruction_text: str

    # Who acted
    actor_id: str | None
    actor_role: AgentRole | None
    action_taken: str | None
    action_params: dict | None

    # Result
    handoff_successful: bool
    latency_turns: int  # Turns between instruction and action

@dataclass
class CoordinationMetrics:
    """Metrics for dual-control evaluation."""

    # Coordination success
    total_handoffs_required: int
    handoffs_completed: int
    coordination_success_rate: float

    # Efficiency
    avg_instruction_to_action_turns: float
    unnecessary_user_actions: int

    # Communication quality (LLM-judged)
    instruction_clarity_score: float  # 0-1
    user_confusion_count: int
```

### 6. Solo vs Dual Mode Comparison

```python
@dataclass
class SoloDualComparison:
    """Compare same task in solo vs dual mode."""
    task_id: str

    # Solo mode: Agent gets all info, acts directly
    solo_trials: int
    solo_successes: int
    solo_pass_1: float
    solo_avg_steps: float

    # Dual mode: Agent must guide user
    dual_trials: int
    dual_successes: int
    dual_pass_1: float
    dual_avg_steps: float

    # The gap (Ï„Â²-bench key finding)
    performance_drop: float  # solo_pass_1 - dual_pass_1
    step_increase: float     # dual_avg_steps - solo_avg_steps

# API endpoint
@router.post("/tasks/{task_id}/compare-modes")
async def compare_solo_dual(
    task_id: str,
    num_trials: int = 8
) -> SoloDualComparison:
    """Run task in both solo and dual mode, compare results."""
    ...
```

### 7. Example: Telecom Troubleshooting Task

```python
TELECOM_DATA_FIX_TASK = DualControlTaskDefinition(
    task_id="telecom_fix_mobile_data",
    name="Fix Mobile Data Issue",
    description="Help customer fix their mobile data connection",
    domain="telecom",
    difficulty="medium",

    simulation_config=SimulationConfig(
        name="Telecom Support Session",
        steps=20,
        topology="pair",
    ),

    # Agent (TechSupport)
    agent_id="tech_support",
    agent_role=AgentRole.SERVICE_AGENT,
    agent_instruction="""You are a telecom support agent. A customer reports their
    mobile data is not working. Diagnose the issue and guide them to fix it.
    You have access to the backend system but cannot control their device directly.""",
    agent_apps=["telecom_backend"],
    agent_initial_state={
        "customers": {
            "C1001": {
                "customer_id": "C1001",
                "full_name": "John Smith",
                "phone_number": "555-123-2002",
                "plan": "unlimited",
                "roaming_enabled": False,
                "account_status": "active"
            }
        }
    },

    # User (John)
    user_id="john",
    user_role=AgentRole.CUSTOMER,
    user_instruction="""Your mobile data is not working. It shows 'No Internet Connection'.
    You need help from tech support to fix this issue. Follow their instructions.""",
    user_apps=["user_device"],
    user_initial_state={
        "mobile_data_enabled": False,  # THE PROBLEM
        "airplane_mode": False,
        "signal_strength": "excellent",
        "battery_level": 80,
        "sim_status": "active"
    },

    # Coordination requirements
    required_handoffs=[
        CoordinationHandoff(
            handoff_id="check_status",
            from_role=AgentRole.SERVICE_AGENT,
            to_role=AgentRole.CUSTOMER,
            instruction_pattern=r"(check|look at|see).*(status|bar|signal)",
            expected_action="get_status_bar",
            description="Agent asks user to check status bar"
        ),
        CoordinationHandoff(
            handoff_id="toggle_data",
            from_role=AgentRole.SERVICE_AGENT,
            to_role=AgentRole.CUSTOMER,
            instruction_pattern=r"(toggle|turn|enable|switch).*(data|mobile data)",
            expected_action="toggle_mobile_data",
            description="Agent asks user to toggle mobile data"
        ),
    ],

    # Goal states
    agent_goal_state={},  # No backend changes needed for this task
    user_goal_state={
        "mobile_data_enabled": True  # Data should be ON
    },

    max_turns=15,
    expected_coordination_count=2
)
```

### 8. Database Schema Extensions

```sql
-- App access control
ALTER TABLE app_definitions ADD COLUMN access_type TEXT DEFAULT 'shared';
ALTER TABLE app_definitions ADD COLUMN allowed_roles JSON;
ALTER TABLE app_definitions ADD COLUMN state_type TEXT DEFAULT 'shared';

-- Action tool types
ALTER TABLE app_definitions ADD COLUMN actions_with_types JSON;
-- Or modify actions JSON to include tool_type per action

-- Dual-control tasks
CREATE TABLE dual_control_tasks (
    id TEXT PRIMARY KEY,
    task_id TEXT NOT NULL UNIQUE,
    name TEXT NOT NULL,
    domain TEXT NOT NULL,
    difficulty TEXT NOT NULL,

    -- Agent side
    agent_instruction TEXT NOT NULL,
    agent_apps JSON NOT NULL,
    agent_initial_state JSON,
    agent_goal_state JSON,

    -- User side
    user_instruction TEXT NOT NULL,
    user_apps JSON NOT NULL,
    user_initial_state JSON,
    user_goal_state JSON,

    -- Coordination
    required_handoffs JSON,
    max_turns INTEGER,

    is_active INTEGER DEFAULT 1,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Coordination events
CREATE TABLE coordination_events (
    id TEXT PRIMARY KEY,
    trial_id TEXT NOT NULL,
    task_id TEXT NOT NULL,

    instructor_id TEXT NOT NULL,
    instructor_role TEXT NOT NULL,
    instruction_text TEXT,

    actor_id TEXT,
    actor_role TEXT,
    action_taken TEXT,
    action_params JSON,

    handoff_successful BOOLEAN,
    latency_turns INTEGER,

    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (trial_id) REFERENCES trial_results(id)
);

-- Solo/dual comparison results
CREATE TABLE solo_dual_comparisons (
    id TEXT PRIMARY KEY,
    task_id TEXT NOT NULL,

    solo_trials INTEGER,
    solo_successes INTEGER,
    solo_pass_1 REAL,

    dual_trials INTEGER,
    dual_successes INTEGER,
    dual_pass_1 REAL,

    performance_drop REAL,

    computed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### 9. API Endpoints

| Method | Endpoint | Description |
|--------|----------|-------------|
| **App Access** |
| GET | `/api/v1/apps/{app_id}/access` | Get app access control |
| PATCH | `/api/v1/apps/{app_id}/access` | Update app access |
| **Dual-Control Tasks** |
| POST | `/api/v1/dual-control-tasks` | Create dual-control task |
| GET | `/api/v1/dual-control-tasks` | List dual-control tasks |
| GET | `/api/v1/dual-control-tasks/{task_id}` | Get task details |
| POST | `/api/v1/dual-control-tasks/{task_id}/run` | Run in dual mode |
| POST | `/api/v1/dual-control-tasks/{task_id}/run-solo` | Run in solo mode |
| POST | `/api/v1/dual-control-tasks/{task_id}/compare` | Run both, compare |
| **Coordination** |
| GET | `/api/v1/trials/{trial_id}/coordination` | Get coordination events |
| GET | `/api/v1/tasks/{task_id}/coordination-metrics` | Get aggregated metrics |

### 10. File Structure

```
src/agentworld/
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ base.py              # EXTEND: Add access_type, state_type
â”‚   â”œâ”€â”€ definition.py        # EXTEND: Add ToolType, allowed_roles
â”‚   â””â”€â”€ telecom/             # NEW: Telecom domain apps
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ backend.py       # TelecomBackendApp
â”‚       â””â”€â”€ device.py        # UserDeviceApp
â”œâ”€â”€ tasks/
â”‚   â”œâ”€â”€ definitions.py       # EXTEND: Add DualControlTaskDefinition
â”‚   â”œâ”€â”€ dual_control.py      # NEW: Dual-control runner
â”‚   â”œâ”€â”€ coordination.py      # NEW: Coordination tracking
â”‚   â””â”€â”€ scenarios/
â”‚       â””â”€â”€ telecom.py       # NEW: Telecom dual-control tasks
â”œâ”€â”€ evaluation/
â”‚   â”œâ”€â”€ coordination_metrics.py  # NEW: Coordination evaluation
â”‚   â””â”€â”€ solo_dual_comparison.py  # NEW: Mode comparison
â””â”€â”€ api/
    â”œâ”€â”€ routes/
    â”‚   â””â”€â”€ dual_control.py  # NEW: Dual-control endpoints
    â””â”€â”€ schemas/
        â””â”€â”€ dual_control.py  # NEW: Request/response schemas
```

## 11. UX Design for App Studio Integration

This section defines the UI/UX changes required to support dual-control in the App Studio and Simulation interfaces.

### 11.1 App Definition UI Changes

#### Step 2 (Info Step) - Access Control Fields

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  App Details                                                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                     â”‚
â”‚  App Name *                 App ID *                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ Telecom Backend       â”‚  â”‚ telecom_backend       â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                     â”‚
â”‚  Category                   Icon                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ Telecom           â–¼   â”‚  â”‚ ğŸ“¡  [Change]          â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  ACCESS CONTROL (NEW)                                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                     â”‚
â”‚  Who can access this app?                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ â—‹ Shared (default)                                             â”‚ â”‚
â”‚  â”‚   All agents in the simulation can use this app               â”‚ â”‚
â”‚  â”‚                                                                â”‚ â”‚
â”‚  â”‚ â— Role-Restricted                                              â”‚ â”‚
â”‚  â”‚   Only agents with specific roles can access                   â”‚ â”‚
â”‚  â”‚                                                                â”‚ â”‚
â”‚  â”‚ â—‹ Per-Agent Instance                                           â”‚ â”‚
â”‚  â”‚   Each agent gets their own isolated copy                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                     â”‚
â”‚  [If Role-Restricted selected:]                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Allowed Roles:                                                 â”‚ â”‚
â”‚  â”‚ â˜‘ Service Agent    â˜ Customer    â˜ Peer                       â”‚ â”‚
â”‚  â”‚                                                                â”‚ â”‚
â”‚  â”‚ â„¹ï¸ Only agents assigned these roles can use this app          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  STATE MANAGEMENT                                                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                     â”‚
â”‚  How is app state managed?                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ â— Shared State                                                 â”‚ â”‚
â”‚  â”‚   All agents share the same app state (e.g., customer DB)     â”‚ â”‚
â”‚  â”‚                                                                â”‚ â”‚
â”‚  â”‚ â—‹ Per-Agent State                                              â”‚ â”‚
â”‚  â”‚   Each agent has isolated state (e.g., personal device)       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                     â”‚
â”‚  âš ï¸ GATING RULES:                                                  â”‚
â”‚  â€¢ If "Per-Agent Instance" selected â†’ State forced to "Per-Agent"  â”‚
â”‚  â€¢ If "Shared" selected â†’ State can be either (default: Shared)    â”‚
â”‚  â€¢ If "Role-Restricted" selected â†’ State can be either             â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Step 3 (Actions Step) - Tool Type Annotation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Actions (6)                                          [+ Add Action]â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ get_customer_by_id                               [Edit] [Ã—]    â”‚ â”‚
â”‚  â”‚ Retrieve customer details from database                        â”‚ â”‚
â”‚  â”‚                                                                â”‚ â”‚
â”‚  â”‚ Tool Type: [ğŸ“– READ â–¼]     â† NEW dropdown                     â”‚ â”‚
â”‚  â”‚ Parameters: customer_id*  â€¢  Returns: customer object          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ enable_roaming                                   [Edit] [Ã—]    â”‚ â”‚
â”‚  â”‚ Enable international roaming for customer                      â”‚ â”‚
â”‚  â”‚                                                                â”‚ â”‚
â”‚  â”‚ Tool Type: [âœï¸ WRITE â–¼]    â† Modifies state                   â”‚ â”‚
â”‚  â”‚ Parameters: customer_id*, plan_type  â€¢  Returns: confirmation  â”‚ â”‚
â”‚  â”‚ âš ï¸ This action modifies customer data                         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ toggle_mobile_data                               [Edit] [Ã—]    â”‚ â”‚
â”‚  â”‚ Turn mobile data ON or OFF                                     â”‚ â”‚
â”‚  â”‚                                                                â”‚ â”‚
â”‚  â”‚ Tool Type: [âœï¸ WRITE â–¼]                                       â”‚ â”‚
â”‚  â”‚ Parameters: (none)  â€¢  Returns: new_state                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                     â”‚
â”‚  LEGEND:  ğŸ“– READ = Query only   âœï¸ WRITE = Modifies state        â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 11.2 Simulation Setup UI Changes

#### Agent Role Assignment

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AGENTS                                                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                     â”‚
â”‚  Configure the agents participating in this simulation.             â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ğŸ‘¤ TechSupport                                                 â”‚ â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚ â”‚
â”‚  â”‚ Persona: [Helpful Support Agent    â–¼]                         â”‚ â”‚
â”‚  â”‚                                                                â”‚ â”‚
â”‚  â”‚ Role: [ğŸ§ Service Agent â–¼]  â† NEW: Role dropdown              â”‚ â”‚
â”‚  â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚ â”‚
â”‚  â”‚       â”‚ ğŸ‘¥ Peer (default)                   â”‚                 â”‚ â”‚
â”‚  â”‚       â”‚ ğŸ§ Service Agent                    â”‚ â† Selected      â”‚ â”‚
â”‚  â”‚       â”‚ ğŸ“± Customer                         â”‚                 â”‚ â”‚
â”‚  â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚ â”‚
â”‚  â”‚                                                                â”‚ â”‚
â”‚  â”‚ Accessible Apps: (auto-filtered by role)                      â”‚ â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚ â”‚
â”‚  â”‚ â”‚ ğŸ“¡ Telecom  â”‚  Backend system access                        â”‚ â”‚
â”‚  â”‚ â”‚    Backend  â”‚                                               â”‚ â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ğŸ‘¤ John                                                        â”‚ â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚ â”‚
â”‚  â”‚ Persona: [Frustrated Customer      â–¼]                         â”‚ â”‚
â”‚  â”‚                                                                â”‚ â”‚
â”‚  â”‚ Role: [ğŸ“± Customer â–¼]                                         â”‚ â”‚
â”‚  â”‚                                                                â”‚ â”‚
â”‚  â”‚ Accessible Apps: (auto-filtered by role)                      â”‚ â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚ â”‚
â”‚  â”‚ â”‚ ğŸ“± User     â”‚  Personal device controls                     â”‚ â”‚
â”‚  â”‚ â”‚    Device   â”‚                                               â”‚ â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                     â”‚
â”‚  [+ Add Agent]                                                      â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### App Access Visualization

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  APPS                                                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                     â”‚
â”‚  Apps available in this simulation, organized by access type.       â”‚
â”‚                                                                     â”‚
â”‚  SHARED APPS (all agents)                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚
â”‚  â”‚ ğŸ’¬ Chat         â”‚  All agents can send/receive messages         â”‚
â”‚  â”‚    SHARED       â”‚                                               â”‚
â”‚  â”‚ ğŸ‘¥ All agents   â”‚                                               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                               â”‚
â”‚                                                                     â”‚
â”‚  ROLE-RESTRICTED APPS                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚  â”‚ ğŸ“¡ Telecom      â”‚  â”‚ ğŸ“± User Device  â”‚                         â”‚
â”‚  â”‚    Backend      â”‚  â”‚                 â”‚                         â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚                         â”‚
â”‚  â”‚ ğŸ§ Service      â”‚  â”‚ ğŸ“± Customer     â”‚                         â”‚
â”‚  â”‚    Agent only   â”‚  â”‚    only         â”‚                         â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚                         â”‚
â”‚  â”‚ ğŸ‘¤ TechSupport  â”‚  â”‚ ğŸ‘¤ John         â”‚                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                                                                     â”‚
â”‚  [+ Add App]                                                        â”‚
â”‚                                                                     â”‚
â”‚  â„¹ï¸ Role-restricted apps are only visible to agents with matching  â”‚
â”‚  roles. Agents cannot see or use apps outside their role.          â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 11.3 Runtime Visualization

#### Simulation Timeline with Coordination Markers

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SIMULATION TIMELINE                                    [â–¶ Running] â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                     â”‚
â”‚  10:23:10  ğŸ‘¤ John (Customer)                                       â”‚
â”‚  â”‚ "Hi, my mobile data isn't working. Can you help?"               â”‚
â”‚  â”‚                                                                  â”‚
â”‚  10:23:15  ğŸ‘¤ TechSupport (Service Agent)                          â”‚
â”‚  â”‚ "I'd be happy to help! Let me look up your account."            â”‚
â”‚  â”‚ âœ“ APP_ACTION: telecom_backend.get_customer_by_id("C1001")       â”‚
â”‚  â”‚   â””â”€ Result: Found customer John Smith                           â”‚
â”‚  â”‚                                                                  â”‚
â”‚  10:23:20  ğŸ‘¤ TechSupport (Service Agent)                          â”‚
â”‚  â”‚ "I see your account is active. Could you please check your      â”‚
â”‚  â”‚  status bar and tell me if you see the mobile data icon?"       â”‚
â”‚  â”‚                                                                  â”‚
â”‚  â”‚ ğŸ¯ COORDINATION REQUESTED                                        â”‚
â”‚  â”‚    From: TechSupport â†’ To: John                                  â”‚
â”‚  â”‚    Expected: get_status_bar                                      â”‚
â”‚  â”‚                                                                  â”‚
â”‚  10:23:25  ğŸ‘¤ John (Customer)                                       â”‚
â”‚  â”‚ âœ“ APP_ACTION: user_device.get_status_bar()                      â”‚
â”‚  â”‚   â””â”€ Result: {mobile_data: OFF, signal: excellent}              â”‚
â”‚  â”‚ "I checked - the mobile data icon shows it's turned off"        â”‚
â”‚  â”‚                                                                  â”‚
â”‚  â”‚ âœ… COORDINATION COMPLETE                                         â”‚
â”‚  â”‚    Handoff successful (1 turn latency)                           â”‚
â”‚  â”‚                                                                  â”‚
â”‚  10:23:30  ğŸ‘¤ TechSupport (Service Agent)                          â”‚
â”‚  â”‚ "That's the issue! Please go to Settings and toggle mobile      â”‚
â”‚  â”‚  data ON."                                                       â”‚
â”‚  â”‚                                                                  â”‚
â”‚  â”‚ ğŸ¯ COORDINATION REQUESTED                                        â”‚
â”‚  â”‚    From: TechSupport â†’ To: John                                  â”‚
â”‚  â”‚    Expected: toggle_mobile_data                                  â”‚
â”‚  â”‚                                                                  â”‚
â”‚  10:23:35  ğŸ‘¤ John (Customer)                                       â”‚
â”‚  â”‚ âœ“ APP_ACTION: user_device.toggle_mobile_data()                  â”‚
â”‚  â”‚   â””â”€ Result: {mobile_data: ON}                                  â”‚
â”‚  â”‚ "Done! I turned it on and now I see the data icon!"             â”‚
â”‚  â”‚                                                                  â”‚
â”‚  â”‚ âœ… COORDINATION COMPLETE                                         â”‚
â”‚  â”‚    Handoff successful (1 turn latency)                           â”‚
â”‚  â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Coordination Metrics Panel

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  COORDINATION METRICS                                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                     â”‚
â”‚  Handoffs                          Efficiency                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  Required:     2        â”‚      â”‚  Avg Latency:  1.0 turnsâ”‚     â”‚
â”‚  â”‚  Completed:    2 âœ“      â”‚      â”‚  Extra Actions: 0       â”‚     â”‚
â”‚  â”‚  Success Rate: 100%     â”‚      â”‚  User Confusion: 0      â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                     â”‚
â”‚  Communication Quality (LLM-judged)                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Instruction Clarity: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  85%             â”‚   â”‚
â”‚  â”‚  Step-by-step:        â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘  90%             â”‚   â”‚
â”‚  â”‚  Confirmation:        â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  100%            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 11.4 Dual-Control Task Definition UI

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Create Evaluation Task                                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                     â”‚
â”‚  Task Type:                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ â—‹ Single-Control                                               â”‚ â”‚
â”‚  â”‚   Agent has full access, acts autonomously                    â”‚ â”‚
â”‚  â”‚                                                                â”‚ â”‚
â”‚  â”‚ â— Dual-Control                                                 â”‚ â”‚
â”‚  â”‚   Agent guides user who has device access                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                     â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚  SERVICE AGENT CONFIGURATION                                        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                     â”‚
â”‚  Agent ID: [tech_support________]                                   â”‚
â”‚                                                                     â”‚
â”‚  Agent Instruction:                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ You are a telecom support agent. A customer reports their   â”‚   â”‚
â”‚  â”‚ mobile data is not working. Diagnose the issue and guide    â”‚   â”‚
â”‚  â”‚ them to fix it. You have access to the backend system but   â”‚   â”‚
â”‚  â”‚ cannot control their device directly.                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  Agent Apps:                                                        â”‚
â”‚  â˜‘ telecom_backend                                                 â”‚
â”‚                                                                     â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚  CUSTOMER CONFIGURATION                                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                     â”‚
â”‚  User ID: [john_________________]                                   â”‚
â”‚                                                                     â”‚
â”‚  User Instruction (simulated behavior):                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Your mobile data is not working. It shows 'No Internet'.    â”‚   â”‚
â”‚  â”‚ You need help from tech support to fix this issue. Follow   â”‚   â”‚
â”‚  â”‚ their instructions.                                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  User Apps:                                                         â”‚
â”‚  â˜‘ user_device                                                     â”‚
â”‚                                                                     â”‚
â”‚  User Initial State:                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ {                                                           â”‚   â”‚
â”‚  â”‚   "mobile_data_enabled": false,  â† THE PROBLEM              â”‚   â”‚
â”‚  â”‚   "airplane_mode": false,                                   â”‚   â”‚
â”‚  â”‚   "signal_strength": "excellent"                            â”‚   â”‚
â”‚  â”‚ }                                                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚  COORDINATION REQUIREMENTS                                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                     â”‚
â”‚  Define expected handoff points:                          [+ Add]   â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ 1. check_status                                         [Ã—]   â”‚ â”‚
â”‚  â”‚    Agent asks user to: Check device status bar                â”‚ â”‚
â”‚  â”‚    User should execute: get_status_bar                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ 2. toggle_data                                          [Ã—]   â”‚ â”‚
â”‚  â”‚    Agent asks user to: Turn on mobile data                    â”‚ â”‚
â”‚  â”‚    User should execute: toggle_mobile_data                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                     â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚  GOAL STATE                                                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                     â”‚
â”‚  User Goal State (device should end up in this state):              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ {                                                           â”‚   â”‚
â”‚  â”‚   "mobile_data_enabled": true  â† SUCCESS CONDITION          â”‚   â”‚
â”‚  â”‚ }                                                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚                                         [Cancel]  [Create Task]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 11.5 Solo vs Dual Comparison View

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Task: Fix Mobile Data Issue                                        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                     â”‚
â”‚  [Run Solo] [Run Dual] [Compare Both]                               â”‚
â”‚                                                                     â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚  COMPARISON RESULTS (8 trials each)                                 â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                                                                     â”‚
â”‚           â”‚  SOLO MODE          â”‚  DUAL MODE          â”‚  DELTA     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  pass^1   â”‚  87.5% (7/8)        â”‚  62.5% (5/8)        â”‚  -25.0 ptsâ”‚  â† Illustrative
â”‚  pass^4   â”‚  45.7%              â”‚  15.2%              â”‚  -30.5 ptsâ”‚
â”‚  Avg Stepsâ”‚  4.2                â”‚  7.8                â”‚  +3.6     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                     PASS RATE COMPARISON                     â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  100% â”¤                                                      â”‚   â”‚
â”‚  â”‚       â”‚  â–ˆâ–ˆâ–ˆâ–ˆ                                                â”‚   â”‚
â”‚  â”‚   75% â”¤  â–ˆâ–ˆâ–ˆâ–ˆ                                                â”‚   â”‚
â”‚  â”‚       â”‚  â–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆ                                          â”‚   â”‚
â”‚  â”‚   50% â”¤  â–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆ                                          â”‚   â”‚
â”‚  â”‚       â”‚  â–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆ                                          â”‚   â”‚
â”‚  â”‚   25% â”¤  â–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆ                                          â”‚   â”‚
â”‚  â”‚       â”‚  â–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆ                                          â”‚   â”‚
â”‚  â”‚    0% â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                â”‚   â”‚
â”‚  â”‚         Solo   Dual                                          â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  â–  Solo Mode (agent has all access)                          â”‚   â”‚
â”‚  â”‚  â–  Dual Mode (agent guides user)                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  KEY INSIGHT:                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ âš ï¸ Ï„Â²-bench found ~25 point drops when agents must guide    â”‚   â”‚
â”‚  â”‚ the user instead of acting directly. This matches Ï„Â²-bench  â”‚   â”‚
â”‚  â”‚ findings on coordination overhead.                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 11.6 Key UX Design Decisions

| Decision | Recommendation | Rationale |
|----------|----------------|-----------|
| Role assignment location | Per-agent in simulation setup | Roles are simulation-specific, not persona-inherent |
| App filtering | Auto-filter by assigned role | Prevent confusion; agents only see accessible apps |
| Coordination markers | Inline in timeline | Clear visual indication of handoff events |
| Tool type display | Badge + icon (ğŸ“–/âœï¸) | Quick visual scan of read vs write actions |
| Backward compatibility | Default to SHARED/PEER | Existing simulations work unchanged |
| State type visibility | Only show when relevant | Don't overwhelm with options for simple apps |
| Dual-control tasks | Separate creation flow | Complex enough to warrant dedicated UI |
| Comparison view | Side-by-side metrics | Easy to see performance drop at a glance |

### 11.7 Component Architecture

> **Note:** These are **proposed** component paths for new dual-control features.
> Existing component paths in the codebase may differ - consult the actual
> `web/src/components` directory for current structure before implementing.
> Components marked "EXTEND" should be added to existing files; "NEW" indicates
> new files to create.

```
web/src/
â”œâ”€â”€ components/
â”‚   â””â”€â”€ app-studio/
â”‚       â”œâ”€â”€ steps/
â”‚       â”‚   â””â”€â”€ InfoStep.tsx           # EXTEND: Add access control section
â”‚       â”œâ”€â”€ ActionCard.tsx             # EXTEND: Add tool type dropdown
â”‚       â””â”€â”€ access/                    # NEW: Access control components
â”‚           â”œâ”€â”€ AccessTypeSelector.tsx # Radio group for access types
â”‚           â”œâ”€â”€ RoleCheckboxes.tsx     # Role selection checkboxes
â”‚           â””â”€â”€ StateTypeSelector.tsx  # Shared vs per-agent state
â”‚
â”œâ”€â”€ components/
â”‚   â””â”€â”€ simulation/
â”‚       â”œâ”€â”€ AgentConfig.tsx            # EXTEND: Add role dropdown
â”‚       â”œâ”€â”€ AppsSection.tsx            # EXTEND: Group by access type
â”‚       â””â”€â”€ roles/                     # NEW: Role-related components
â”‚           â”œâ”€â”€ RoleSelector.tsx       # Agent role dropdown
â”‚           â””â”€â”€ RoleAppFilter.tsx      # Filter apps by role
â”‚
â”œâ”€â”€ components/
â”‚   â””â”€â”€ simulation/
â”‚       â””â”€â”€ timeline/
â”‚           â”œâ”€â”€ CoordinationMarker.tsx # NEW: Handoff event marker
â”‚           â”œâ”€â”€ CoordinationPanel.tsx  # NEW: Metrics sidebar
â”‚           â””â”€â”€ TimelineEvent.tsx      # EXTEND: Coordination styling
â”‚
â”œâ”€â”€ components/
â”‚   â””â”€â”€ tasks/
â”‚       â”œâ”€â”€ DualControlTaskForm.tsx    # NEW: Dual-control task creation
â”‚       â”œâ”€â”€ HandoffEditor.tsx          # NEW: Define expected handoffs
â”‚       â”œâ”€â”€ GoalStateEditor.tsx        # NEW: Define success state
â”‚       â””â”€â”€ SoloDualComparison.tsx     # NEW: Comparison results view
â”‚
â””â”€â”€ pages/
    â”œâ”€â”€ AppCreate.tsx                  # EXTEND: Access control step
    â”œâ”€â”€ SimulationCreate.tsx           # EXTEND: Role assignment
    â”œâ”€â”€ SimulationView.tsx             # EXTEND: Coordination markers
    â””â”€â”€ TaskCreate.tsx                 # NEW: Dual-control task page
```

### 11.8 Implementation Phases (UI)

| Phase | Components | Dependencies | Estimate |
|-------|------------|--------------|----------|
| **UI-1: App Access Control** | AccessTypeSelector, RoleCheckboxes, StateTypeSelector, InfoStep updates | Backend Phase 1 | 2-3 days |
| **UI-2: Tool Type Annotation** | ActionCard updates, ToolTypeBadge | Backend Phase 2 | 1 day |
| **UI-3: Role Assignment** | RoleSelector, RoleAppFilter, AgentConfig updates | Backend Phase 1 | 2 days |
| **UI-4: App Grouping** | AppsSection updates, AccessGroupedView | UI-1, UI-3 | 1 day |
| **UI-5: Coordination Timeline** | CoordinationMarker, CoordinationPanel, TimelineEvent updates | Backend Phase 3 | 2-3 days |
| **UI-6: Task Creation** | DualControlTaskForm, HandoffEditor, GoalStateEditor | Backend Phase 3 | 3-4 days |
| **UI-7: Comparison View** | SoloDualComparison, ComparisonChart | Backend Phase 5 | 2 days |

**Total UI Estimate: 13-16 days** (can run in parallel with backend after Phase 1)

## Consequences

### Positive
- Can measure Ï„Â²-bench style performance drop
- Enables agent-user coordination research
- Compatible with existing multi-agent system
- Reuses app framework with extensions

### Negative
- Increases complexity of app definitions
- Requires new task authoring for dual-control
- Coordination tracking adds overhead
- Two evaluation modes to maintain

## Implementation Phases

### Phase 1: App Access Control (2-3 days)
- Add `access_type`, `allowed_roles`, `state_type` to AppDefinition
- Implement access checking in app execution
- Add per-agent state management

### Phase 2: Tool Type Annotations (1 day)
- Add `ToolType` enum
- Update ActionDefinition
- Add to API schemas

### Phase 3: Dual-Control Tasks (3-4 days)
- Create DualControlTaskDefinition
- Implement dual-control runner
- Add coordination tracking

### Phase 4: Telecom Domain (2-3 days)
- Implement TelecomBackendApp
- Implement UserDeviceApp
- Create sample tasks

### Phase 5: Solo/Dual Comparison (2 days)
- Implement comparison runner
- Add comparison API
- Generate performance drop metrics

### Phase 6: Coordination Metrics (2 days)
- Implement coordination event tracking
- Add LLM-based instruction clarity scoring
- Create coordination report

**Backend Total: 12-15 days**

> **Note:** UI implementation (Section 11.8) adds 13-16 days, but can run in parallel
> with backend after Phase 1 completes. See Section 11.8 for UI phase breakdown.
> **Combined estimate with parallelization: 18-25 days** (not 25-31 days sequential).

## Validation Checklist

### REQ-20.1-01: App Access Control

| Test | Expected |
|------|----------|
| Service agent uses backend app | âœ… Allowed |
| Customer uses backend app | âŒ Denied |
| Customer uses device app | âœ… Allowed |
| Service agent uses device app | âŒ Denied |

### REQ-20.1-02: Per-Agent App State

| Test | Expected |
|------|----------|
| John toggles his data | Only John's device state changes |
| Jane's device unaffected | Jane's data_enabled unchanged |

### REQ-20.1-05: Coordination Tracking

| Test | Expected |
|------|----------|
| Agent says "toggle your data" | CoordinationEvent created |
| User executes toggle_mobile_data | Event marked successful |
| User ignores instruction | Event marked failed |

### REQ-20.1-06: Solo/Dual Comparison

| Test | Expected |
|------|----------|
| Same task, solo mode | Higher pass^1 |
| Same task, dual mode | Lower pass^1 |
| Performance drop calculated | Measurable gap (Ï„Â²-bench saw ~15-25 pts) |

---

## Related ADRs

- **ADR-020**: Ï„-bench Evaluation (base)
- **ADR-017**: Simulated Apps Framework
- **ADR-018**: App Studio Backend
- **ADR-021**: App Benchmark & Quality

## UI Reference

See [docs/agentworld-adr-review.jsx](../docs/agentworld-adr-review.jsx) for interactive UI mockups including:
- App Studio Access Control step
- Dual-Control Simulation view with coordination markers
- Role assignment in simulation setup

## References

- [Ï„Â²-bench Paper](https://arxiv.org/abs/2506.07982) - Dong et al., 2025
- [Ï„Â²-bench GitHub](https://github.com/sierra-research/tau2-bench)
- [Sierra Blog](https://sierra.ai/uk/blog/benchmarking-agents-in-collaborative-real-world-scenarios)
